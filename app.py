from flask import Flask, jsonify, request, url_for, render_template
import json
import config
import twitterApi
import translateAPI

app = Flask(__name__)


@app.route('/')
def homepage():
    '''
    Returns the homepage
    '''
    return render_template("index.html")


@app.route('/map', methods=['GET'])
@app.route('/map/', methods=['GET'])

def display_map():
    '''
    At this endpoint we show the full world map via Google Maps. 
    The Google Maps Key is passed to access the map. 
    The Google Translate Key is passed to access Google Translation.
    '''
    key = config.MapsAPIKey
    geo = config.googleKeyTranslate
    return render_template("maps.html", key=key, geo=geo)


@app.route('/translate/', methods=['POST'])
def translate():
    '''
    Takes a text via POST request and translates it in the function translate(text).
    Returns the translated text.
    '''
    text = request.json["tweetText"]
    translatedText = translateAPI.translate(text)
    translatedText = translatedText.decode()
    return translatedText
    

@app.route('/tweet/<place>', methods=['GET'])
def display_tweet(place):
    '''
    Takes a place and returns its most popular topic Tweet with most likes.
    Returns the most popular Tweet for a specific topic.
    '''
    country = twitterApi.getPlace(place) 
    country_list = twitterApi.getTheTrendingTweets(country)
    tweet = twitterApi.getTextFromTrending(country_list)
    tweet = json.dumps(tweet, indent=4, sort_keys=True, default=str, ensure_ascii=False)

    return tweet

            
@app.route("/apidocs")
@app.route("/apidocs/")
def swagger():
    '''
    Shows documentation for the API.
    Html is generated by Swagger.
    '''
    return render_template("swagger.html")
