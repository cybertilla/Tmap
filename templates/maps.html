{% extends "base.html" %} {% block header %}
<script>
    function initMap() {
        var data = {
            lat: null,
            lng: null
        };

        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 47.54,
                lng: 19.19
            },
            zoom: 3,
            styles: [{
                featureType: 'poi',
                stylers: [{
                        visibility: 'off'
                    }] // Turn off POI.
            }, {
                featureType: 'transit.station',
                stylers: [{
                        visibility: 'off'
                    }] // Turn off bus, train stations etc.
            }],
            disableDoubleClickZoom: true,
            streetViewControl: false,
        });
        const geocoder = new google.maps.Geocoder();
        const infowindow = new google.maps.InfoWindow();
        map.addListener('click', function(e) {
            data.lat = e.latLng.lat();
            data.lng = e.latLng.lng();
            geocodeLatLng(geocoder, map, infowindow, data.lat, data.lng)}
            );
}


function geocodeLatLng(geocoder, map, infowindow, lat, long) {
  const latlng = {
    lat: parseFloat(lat),
    lng: parseFloat(long),
  };

  geocoder
    .geocode({ location: latlng })
    .then((response) => {
      if (response.results[0]) {
        map.setZoom(3);

        const marker = new google.maps.Marker({
          position: latlng,
          map: map,
        });

        infowindow.setContent(response.results[4].formatted_address);
        infowindow.open(map, marker);

        var address = response.results[4].formatted_address;
        var newAdd = address.split(", ");
        var newAddress = newAdd[newAdd.length - 1];

    readAPI(newAddress)

      } else {
        window.alert("No results found");
      }
    })
    .catch((e) => console.log("Geocoder failed due to: " + e));

}

function readAPI(newAddress) {
  
  fetch('http://127.0.0.1:5000/tweets/' + newAddress)
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.log('Nothing is trending here'));
}



</script>


{%endblock%} {% block content %}
<h3>Check out this trend map</h3>
<div id="map"> </div>
<div>
  <p>{{y}}</p>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key={{geo}}&language=en&callback=initMap&libraries=&v=weekly" async></script>

{%endblock%}